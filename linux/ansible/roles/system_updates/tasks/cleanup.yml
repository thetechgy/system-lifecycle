---
# APT cleanup tasks (run after other updates)

- name: Remove unused packages (autoremove)
  ansible.builtin.apt:
    autoremove: true
  become: true

- name: Clean package cache (autoclean)
  ansible.builtin.apt:
    autoclean: true
  when: not apt_full_clean
  become: true

- name: Clean package cache (full clean)
  ansible.builtin.command: apt-get clean
  when:
    - apt_full_clean
    - not ansible_check_mode
  changed_when: false  # Idempotent cleanup operation
  become: true

- name: Skip full clean in check mode
  ansible.builtin.debug:
    msg: "Check mode: skipping apt-get clean; run without --check to clean package cache"
  when:
    - apt_full_clean
    - ansible_check_mode
